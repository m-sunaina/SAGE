<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sage Network | Security Tracking System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #1a472a;
            --secondary-color: #2d3436;
            --accent-color: #00b894;
            --light-color: #dfe6e9;
            --dark-color: #1a472a;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .navbar {
            background-color: var(--primary-color) !important;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .navbar-brand {
            font-weight: 700;
            color: white !important;
        }
        
        .hero-section {
            background: linear-gradient(135deg, var(--primary-color), #2d3436);
            color: white;
            padding: 4rem 0;
            margin-bottom: 2rem;
            border-radius: 0 0 20px 20px;
        }
        
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
            margin-bottom: 20px;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            background-color: var(--primary-color);
            color: white;
            border-radius: 10px 10px 0 0 !important;
            font-weight: 600;
        }
        
        .score-high {
            color: #d63031;
            font-weight: bold;
        }
        
        .score-medium {
            color: #f39c12;
            font-weight: bold;
        }
        
        .score-low {
            color: #00b894;
            font-weight: bold;
        }
        
        .network-path {
            stroke: var(--accent-color);
            stroke-width: 2;
            fill: none;
        }
        
        .node {
            fill: var(--primary-color);
            cursor: pointer;
            transition: r 0.3s ease;
        }
        
        .node:hover {
            r: 25;
        }
        
        .vpn-node {
            fill: #6c5ce7;
        }
        
        .firewall-node {
            fill: #d63031;
        }
        
        .server-node {
            fill: #0984e3;
        }
        
        .footer {
            background-color: var(--dark-color);
            color: white;
            padding: 2rem 0;
            margin-top: 3rem;
        }
        
        .timeline {
            position: relative;
            padding-left: 50px;
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--accent-color);
        }
        
        .timeline-item {
            position: relative;
            margin-bottom: 30px;
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -40px;
            top: 5px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent-color);
            border: 3px solid white;
        }
        
        .badge-vpn {
            background-color: #6c5ce7;
            color: white;
        }
        
        .infographic-container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }
        
        .node-info {
            position: absolute;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
            pointer-events: none;
            display: none;
        }
        
        .download-btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
        }
        
        .download-btn:hover {
            background-color: #009975;
            color: white;
        }
        
        .speed-test {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .speed-meter {
            height: 20px;
            background: linear-gradient(to right, #00b894, #fdcb6e, #d63031);
            border-radius: 10px;
            margin-bottom: 10px;
        }

    #randomizeBtn {
    padding: 10px 20px;
    background-color: #3498db;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    margin: 5px;
    transition: background-color 0.3s;
}

#randomizeBtn:hover {
    background-color: #2980b9;
}

#traverseBtn {
    padding: 10px 20px;
    background-color: #2ecc71;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    margin: 5px;
    transition: background-color 0.3s;
}

#traverseBtn:hover {
    background-color: #27ae60;
}

#traverseBtn:disabled {
    background-color: #95a5a6;
    cursor: not-allowed;
}

/* Network Container */
#network {
    width: 600px;
    height: 400px;
    border: 1px solid #ccc;
    margin: 20px 0;
    position: relative;
    background-color: #f8f9fa;
    border-radius: 8px;
}

/* Node Styles */
.node {
    position: absolute;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: #3498db;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 2;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}

/* Node Label Styles (positioned below node) */
.node-label {
    position: absolute;
    top: 45px; /* Position below node */
    left: 50%;
    transform: translateX(-50%);
    color: black;
    font-size: 12px;
    font-weight: bold;
    text-align: center;
    width: 80px; /* Give enough width for text */
    background-color: rgba(255,255,255,0.8);
    padding: 2px 5px;
    border-radius: 3px;
    z-index: 3;
}

/* Connection/Edge Styles */
.connection {
    position: absolute;
    height: 3px;
    background-color: #7f8c8d;
    transform-origin: 0 0;
    z-index: 1;
}

/* Packet Animation Styles */
.packet {
    position: absolute;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background-color: #e74c3c;
    transition: all 0.5s ease;
    z-index: 10;
    box-shadow: 0 0 5px rgba(231, 76, 60, 0.7);
}

/* Special Node Types */
.node.client {
    background-color: #9b59b6;
}

.node.router {
    background-color: #3498db;
}

.node.firewall {
    background-color: #e74c3c;
}

.node.server {
    background-color: #2ecc71;
}
    
    </style>
</head>
<body>

    
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark mb-4">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-shield-alt me-2"></i>Sage Network
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#tracking">Tracking</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#reputation">Reputation</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#profile">Profile</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#resources">Resources</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container text-center">
            <h1 class="display-4 fw-bold mb-3">Sage Network Security</h1>
            <p class="lead">Advanced IP reputation monitoring with behavioral analysis and threat detection</p>
            <div class="d-flex justify-content-center gap-3 mt-4">
                <button class="btn btn-light btn-lg px-4">Live Demo</button>
                <button class="btn btn-outline-light btn-lg px-4">Documentation</button>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <div class="container">
        <!-- IP Tracking Simulator -->
        <section id="tracking" class="mb-5">
            <div class="row mb-4">
                <div class="col-12">
                    <h2 class="fw-bold border-bottom pb-2">Network Path Tracking</h2>
                    <p class="text-muted">Visualize request paths and analyze security threats in real-time.</p>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <i class="fas fa-user-secret me-2"></i>Security Analyzer
                        </div>
                        <div class="card-body">
                            <form id="ipForm">
                                <div class="mb-3">
                                    <label for="ipAddress" class="form-label">IP Address</label>
                                    <input type="text" class="form-control" id="ipAddress" placeholder="e.g. 192.168.1.1" value="104.28.245.93">
                                </div>
                                <div class="mb-3 form-check">
                                    <input type="checkbox" class="form-check-input" id="useVPN">
                                    <label class="form-check-label" for="useVPN">Using VPN</label>
                                </div>
                                <div class="mb-3">
                                    <label for="userAgent" class="form-label">User Profile</label>
                                    <select class="form-select" id="userAgent">
                                        <option>Standard User (normal browsing)</option>
                                        <option>IT Administrator (elevated access)</option>
                                        <option selected>Security Scanner (automated tools)</option>
                                        <option>Malicious Actor (known threats)</option>
                                    </select>
                                </div>
                                <div class="d-grid gap-2">
                                    <button type="submit" class="btn btn-primary">Analyze Network Path</button>
                                    <button type="button" id="downloadReport" class="btn download-btn" disabled>
                                        <i class="fas fa-download me-2"></i>Download Report
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <div class="card mt-4">
                        <div class="card-header">
                            <i class="fas fa-chart-line me-2"></i>Reputation Score Breakdown
                        </div>
                        <div class="card-body">
                            <div id="scoreResults" class="text-center py-4">
                                <p class="text-muted">Submit an IP address to see reputation analysis</p>
                            </div>
                            <div class="progress mb-3" style="height: 25px;">
                                <div id="riskBar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div>
                            </div>
                            <div id="scoreDetails" class="small">
                                <!-- Filled by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span><i class="fas fa-project-diagram me-2"></i>Network Path Visualization</span>
                            <button id="pathHelp" class="btn btn-sm btn-outline-light">
                                <i class="fas fa-info-circle"></i>
                            </button>
                        </div>
                        <div class="card-body">
                            <div id="networkDiagram" style="height: 500px; position: relative;">
                                <div id="nodeInfo" class="node-info"></div>
                                 <h1>Network Path Traversal</h1>
    <div id="network"></div>
    <div>
        <button id="randomizeBtn">Randomize Positions</button>
        <button id="traverseBtn">Traverse Network</button>
    </div>
                            <div id="pathDetails" class="mt-3 small">
                                <!-- Filled by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- User Profile Section -->
        <section id="profile" class="mb-5">
            <div class="row mb-4">
                <div class="col-12">
                    <h2 class="fw-bold border-bottom pb-2">User Profile & Behavior Analysis</h2>
                    <p class="text-muted">Comprehensive security profile based on your network behavior.</p>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-4 mb-4">
                    <div class="card h-100">
                        <div class="card-header bg-success bg-opacity-10 text-success">
                            <i class="fas fa-user-circle me-2"></i>Your Security Profile
                        </div>
                        <div class="card-body">
                            <div class="text-center mb-4">
                                <div class="position-relative d-inline-block">
                                    <i class="fas fa-user-shield" style="font-size: 4rem; color: var(--primary-color);"></i>
                                    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                                        85%
                                        <span class="visually-hidden">security score</span>
                                    </span>
                                </div>
                                <h5 class="mt-2">Security Conscious User</h5>
                            </div>
                            
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    VPN Usage
                                    <span class="badge bg-primary rounded-pill">Frequent</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    Typical Locations
                                    <span class="badge bg-primary rounded-pill">3 Countries</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    Device Types
                                    <span class="badge bg-primary rounded-pill">2 Devices</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    Threat Events
                                    <span class="badge bg-danger rounded-pill">2 Blocked</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4 mb-4">
                    <div class="card h-100">
                        <div class="card-header bg-info bg-opacity-10 text-info">
                            <i class="fas fa-tachometer-alt me-2"></i>Network Speed Test
                        </div>
                        <div class="card-body">
                            <div class="speed-test text-center">
                                <h5>Connection Speed</h5>
                                <div class="speed-meter mb-2"></div>
                                <div class="d-flex justify-content-between mb-3">
                                    <span>0 Mbps</span>
                                    <span>50 Mbps</span>
                                    <span>100+ Mbps</span>
                                </div>
                                <button id="runSpeedTest" class="btn btn-sm btn-primary">
                                    <i class="fas fa-play me-1"></i>Run Test
                                </button>
                                <div id="speedResult" class="mt-3">
                                    <p class="mb-1">Last test: Not run yet</p>
                                    <p class="small text-muted">Speed affects your security profile score</p>
                                </div>
                            </div>
                            <hr>
                            <h5>Behavior Analysis</h5>
                            <div class="mb-3">
                                <div class="d-flex justify-content-between mb-1">
                                    <span>Typical Activity Hours</span>
                                    <span>85% Match</span>
                                </div>
                                <div class="progress" style="height: 10px;">
                                    <div class="progress-bar bg-success" style="width: 85%"></div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="d-flex justify-content-between mb-1">
                                    <span>Request Patterns</span>
                                    <span>92% Normal</span>
                                </div>
                                <div class="progress" style="height: 10px;">
                                    <div class="progress-bar bg-success" style="width: 92%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4 mb-4">
                    <div class="card h-100">
                        <div class="card-header bg-warning bg-opacity-10 text-warning">
                            <i class="fas fa-robot me-2"></i>AI Security Assistant
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info small">
                                <i class="fas fa-info-circle me-2"></i>Chat with our AI to understand your security profile and risks.
                            </div>
                            <div id="ollamaChat" class="mb-3 p-2 bg-light rounded" style="height: 150px; overflow-y: auto;">
                                <div class="ollama-message bot small p-2 bg-white rounded mb-2">
                                    <strong>Sage AI:</strong> Hello! I can analyze your network security profile. What would you like to know?
                                </div>
                            </div>
                            <div class="input-group">
                                <input type="text" id="ollamaInput" class="form-control form-control-sm" placeholder="Ask about your risk score...">
                                <button class="btn btn-sm btn-primary" id="askOllama">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                            <div class="d-grid mt-2">
                                <button class="btn btn-sm btn-outline-primary" id="quickQuestions">
                                    <i class="fas fa-bolt me-1"></i>Quick Questions
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- How It Works -->
        <section id="reputation" class="mb-5">
            <div class="row mb-4">
                <div class="col-12">
                    <h2 class="fw-bold border-bottom pb-2">IP Reputation Scoring System</h2>
                    <p class="text-muted">Our proprietary algorithm evaluates multiple factors to determine IP threat levels.</p>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-4 mb-4">
                    <div class="card h-100">
                        <div class="card-header bg-success bg-opacity-10 text-success">
                            <i class="fas fa-check-circle me-2"></i>Scoring Factors
                        </div>
                        <div class="card-body">
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    Geographic anomalies
                                    <span class="badge bg-primary rounded-pill">20%</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    VPN/Proxy detection
                                    <span class="badge bg-primary rounded-pill">25%</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    Historical behavior
                                    <span class="badge bg-primary rounded-pill">30%</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    Request patterns
                                    <span class="badge bg-primary rounded-pill">15%</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    Device fingerprint
                                    <span class="badge bg-primary rounded-pill">10%</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4 mb-4">
                    <div class="card h-100">
                        <div class="card-header bg-warning bg-opacity-10 text-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>Risk Levels
                        </div>
                        <div class="card-body">
                            <div class="mb-4">
                                <h5 class="d-flex justify-content-between">
                                    <span class="score-low">0-30: Low Risk</span>
                                    <span class="badge bg-success">Safe</span>
                                </h5>
                                <p class="small">Normal user traffic with no suspicious patterns.</p>
                            </div>
                            <div class="mb-4">
                                <h5 class="d-flex justify-content-between">
                                    <span class="score-medium">31-70: Medium Risk</span>
                                    <span class="badge bg-warning">Monitor</span>
                                </h5>
                                <p class="small">Potential scanning or automated behavior detected.</p>
                            </div>
                            <div>
                                <h5 class="d-flex justify-content-between">
                                    <span class="score-high">71-100: High Risk</span>
                                    <span class="badge bg-danger">Block</span>
                                </h5>
                                <p class="small">Clear malicious intent or confirmed attack patterns.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4 mb-4">
                    <div class="card h-100">
                        <div class="card-header bg-info bg-opacity-10 text-info">
                            <i class="fas fa-network-wired me-2"></i>VPN Impact
                        </div>
                        <div class="card-body">
                            <div class="alert alert-warning small">
                                <i class="fas fa-info-circle me-2"></i>VPN usage increases risk score by 15-25 points depending on VPN provider reputation.
                            </div>
                            <h5>Top VPN Providers</h5>
                            <ul class="list-group list-group-flush small">
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    Commercial VPNs
                                    <span class="badge bg-secondary rounded-pill">+15 pts</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    Free/Public VPNs
                                    <span class="badge bg-danger rounded-pill">+25 pts</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    Tor Exit Nodes
                                    <span class="badge bg-danger rounded-pill">+30 pts</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Documentation -->
        <section id="resources" class="mb-5">
            <div class="row mb-4">
                <div class="col-12">
                    <h2 class="fw-bold border-bottom pb-2">Documentation & Resources</h2>
                    <p class="text-muted">Learn how to use Sage Network and understand your security profile.</p>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6 mb-4">
                    <div class="card h-100">
                        <div class="card-header">
                            <i class="fas fa-book me-2"></i>Understanding Your Profile
                        </div>
                        <div class="card-body">
                            <h5>Security Score Components</h5>
                            <p class="small">Your security score is calculated based on multiple factors that assess your network behavior and configuration:</p>
                            
                            <div class="accordion mb-3" id="profileAccordion">
                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">
                                            <i class="fas fa-lock me-2"></i>Encryption & VPN Usage
                                        </button>
                                    </h2>
                                    <div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#profileAccordion">
                                        <div class="accordion-body small">
                                            Using VPNs and encrypted connections improves your privacy but may increase your risk score as VPN IPs are often shared.
                                        </div>
                                    </div>
                                </div>
                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo">
                                            <i class="fas fa-globe me-2"></i>Geographic Patterns
                                        </button>
                                    </h2>
                                    <div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#profileAccordion">
                                        <div class="accordion-body small">
                                            Consistent geographic patterns are safer. Frequent country changes may trigger additional scrutiny.
                                        </div>
                                    </div>
                                </div>
                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree">
                                            <i class="fas fa-clock me-2"></i>Activity Timing
                                        </button>
                                    </h2>
                                    <div id="collapseThree" class="accordion-collapse collapse" data-bs-parent="#profileAccordion">
                                        <div class="accordion-body small">
                                            Activity during typical hours for your region is considered lower risk than unusual hours.
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <h5>Improving Your Score</h5>
                            <ul class="small">
                                <li>Use reputable VPN providers</li>
                                <li>Maintain consistent access patterns</li>
                                <li>Keep your devices and software updated</li>
                                <li>Run regular speed tests to monitor connection quality</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6 mb-4">
                    <div class="card h-100">
                        <div class="card-header">
                            <i class="fas fa-chart-bar me-2"></i>Network Analysis Guide
                        </div>
                        <div class="card-body">
                            <h5>Interpreting Network Paths</h5>
                            <p class="small">The network path visualization shows how your requests travel through different security checkpoints:</p>
                            
                            <div class="row mb-3">
                                <div class="col-6">
                                    <div class="d-flex align-items-center mb-2">
                                        <svg width="20" height="20" class="me-2">
                                            <circle cx="10" cy="10" r="8" fill="#1a472a"></circle>
                                        </svg>
                                        <span class="small">Standard Node</span>
                                    </div>
                                    <div class="d-flex align-items-center mb-2">
                                        <svg width="20" height="20" class="me-2">
                                            <circle cx="10" cy="10" r="8" fill="#6c5ce7"></circle>
                                        </svg>
                                        <span class="small">VPN Connection</span>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="d-flex align-items-center mb-2">
                                        <svg width="20" height="20" class="me-2">
                                            <circle cx="10" cy="10" r="8" fill="#d63031"></circle>
                                        </svg>
                                        <span class="small">Firewall</span>
                                    </div>
                                    <div class="d-flex align-items-center mb-2">
                                        <svg width="20" height="20" class="me-2">
                                            <circle cx="10" cy="10" r="8" fill="#0984e3"></circle>
                                        </svg>
                                        <span class="small">Server</span>
                                    </div>
                                </div>
                            </div>
                            
                            <h5>Interactive Features</h5>
                            <ul class="small">
                                <li><strong>Hover over nodes</strong> to see detailed information</li>
                                <li><strong>Click on connections</strong> to view path details</li>
                                <li><strong>Download reports</strong> for comprehensive analysis</li>
                                <li><strong>Chat with AI</strong> to understand specific risks</li>
                            </ul>
                            
                            <div class="alert alert-info small mt-3">
                                <i class="fas fa-lightbulb me-2"></i>Tip: Run speed tests regularly as connection quality affects your security profile.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
    
    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-4 mb-md-0">
                    <h5><i class="fas fa-shield-alt me-2"></i>Sage Network</h5>
                    <p class="small">Advanced network security monitoring and threat detection for modern enterprises.</p>
                    <div class="mt-3">
                        <a href="#" class="text-white me-2"><i class="fab fa-twitter fa-lg"></i></a>
                        <a href="#" class="text-white me-2"><i class="fab fa-linkedin fa-lg"></i></a>
                        <a href="#" class="text-white me-2"><i class="fab fa-github fa-lg"></i></a>
                    </div>
                </div>
                <div class="col-md-2 mb-4 mb-md-0">
                    <h5>Product</h5>
                    <ul class="list-unstyled small">
                        <li class="mb-2"><a href="#" class="text-white text-decoration-none">Features</a></li>
                        <li class="mb-2"><a href="#" class="text-white text-decoration-none">Pricing</a></li>
                        <li class="mb-2"><a href="#" class="text-white text-decoration-none">API</a></li>
                        <li class="mb-2"><a href="#" class="text-white text-decoration-none">Integrations</a></li>
                    </ul>
                </div>
                <div class="col-md-2 mb-4 mb-md-0">
                    <h5>Resources</h5>
                    <ul class="list-unstyled small">
                        <li class="mb-2"><a href="#" class="text-white text-decoration-none">Documentation</a></li>
                        <li class="mb-2"><a href="#" class="text-white text-decoration-none">Blog</a></li>
                        <li class="mb-2"><a href="#" class="text-white text-decoration-none">Guides</a></li>
                        <li class="mb-2"><a href="#" class="text-white text-decoration-none">Research</a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h5>Contact Us</h5>
                    <ul class="list-unstyled small">
                        <li class="mb-2"><i class="fas fa-envelope me-2"></i>security@sagenetwork.com</li>
                        <li class="mb-2"><i class="fas fa-phone me-2"></i>+1 (555) 123-4567</li>
                        <li class="mb-2"><i class="fas fa-map-marker-alt me-2"></i>123 Security Ave, San Francisco, CA</li>
                    </ul>
                </div>
            </div>
            <hr class="mt-4 mb-3" style="border-color: rgba(255,255,255,0.1);">
            <div class="row">
                <div class="col-md-6 text-center text-md-start small">
                    &copy; 2023 Sage Network. All rights reserved.
                </div>
                <div class="col-md-6 text-center text-md-end small">
                    <a href="#" class="text-white text-decoration-none me-3">Privacy Policy</a>
                    <a href="#" class="text-white text-decoration-none me-3">Terms of Service</a>
                    <a href="#" class="text-white text-decoration-none">GDPR</a>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Form submission handler
            document.getElementById('ipForm').addEventListener('submit', function(e) {
                e.preventDefault();
                analyzeIP();
            });
            
            // Download report handler
            document.getElementById('downloadReport').addEventListener('click', downloadReport);
            
            // Speed test handler
            document.getElementById('runSpeedTest').addEventListener('click', runSpeedTest);
            
            // Ollama chat handlers
            document.getElementById('askOllama').addEventListener('click', sendOllamaMessage);
            document.getElementById('ollamaInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') sendOllamaMessage();
            });
            
            // Quick questions handler
            document.getElementById('quickQuestions').addEventListener('click', function() {
                const questions = [
                    "What's my current risk score?",
                    "How can I improve my security?",
                    "Why is my VPN increasing my risk?",
                    "What does my network path mean?"
                ];
                
                const ollamaChat = document.getElementById('ollamaChat');
                questions.forEach(q => {
                    const div = document.createElement('div');
                    div.className = 'ollama-question small p-2 mb-2 border rounded bg-white';
                    div.textContent = q;
                    div.style.cursor = 'pointer';
                    div.addEventListener('click', function() {
                        document.getElementById('ollamaInput').value = q;
                    });
                    ollamaChat.appendChild(div);
                });
                
                // Auto-scroll to bottom
                ollamaChat.scrollTop = ollamaChat.scrollHeight;
            });
            
            // Network path help
            document.getElementById('pathHelp').addEventListener('click', function() {
                alert("Hover over nodes to see details. The path shows how your request travels through network components with security checks.");
            });
        });
        
        function analyzeIP() {
            const ipAddress = document.getElementById('ipAddress').value;
            const useVPN = document.getElementById('useVPN').checked;
            const userAgent = document.getElementById('userAgent').value;
            
            // Generate random but realistic scores based on inputs
            let baseScore = Math.floor(Math.random() * 30) + 10; // 10-40 base
            
            // Adjust based on user profile selection
            if (userAgent.includes("Administrator")) baseScore += 10;
            if (userAgent.includes("Scanner")) baseScore += 30;
            if (userAgent.includes("Malicious")) baseScore += 50;
            
            // Add for VPN
            if (useVPN) baseScore += 20 + Math.floor(Math.random() * 10);
            
            // Cap at 100
            const finalScore = Math.min(baseScore, 100);
            
            // Determine risk level
            let riskLevel, riskClass;
            if (finalScore <= 30) {
                riskLevel = "Low Risk";
                riskClass = "score-low";
            } else if (finalScore <= 70) {
                riskLevel = "Medium Risk";
                riskClass = "score-medium";
            } else {
                riskLevel = "High Risk";
                riskClass = "score-high";
            }
            
            // Update score display
            const scoreResults = document.getElementById('scoreResults');
            scoreResults.innerHTML = `
                <h3 class="${riskClass}">Reputation Score: ${finalScore}/100</h3>
                <p class="text-muted">${riskLevel}</p>
            `;
            
            // Update progress bar
            const riskBar = document.getElementById('riskBar');
            riskBar.style.width = `${finalScore}%`;
            riskBar.className = `progress-bar progress-bar-striped progress-bar-animated ${
                finalScore <= 30 ? 'bg-success' : finalScore <= 70 ? 'bg-warning' : 'bg-danger'
            }`;
            
            // Update score details
            const scoreDetails = document.getElementById('scoreDetails');
            scoreDetails.innerHTML = `
                <div class="row">
                    <div class="col-6">
                        <p><strong>IP Address:</strong> ${ipAddress}</p>
                        <p><strong>VPN Detected:</strong> ${useVPN ? '<span class="badge badge-vpn">Yes</span>' : 'No'}</p>
                        <p><strong>Profile Type:</strong> ${userAgent.split(' (')[0]}</p>
                    </div>
                    <div class="col-6">
                        <p><strong>Risk Factors:</strong> ${
                            userAgent.includes("Bot") ? 'Automated behavior' : 
                            userAgent.includes("Malicious") ? 'Known threats' : 'Normal patterns'
                        }</p>
                        <p><strong>Recommendation:</strong> ${
                            finalScore <= 30 ? 'Allow' : 
                            finalScore <= 70 ? 'Monitor closely' : 'Block immediately'
                        }</p>
                    </div>
                </div>
            `;
            
            // Enable download button
            document.getElementById('downloadReport').disabled = false;
            
            // Generate network path visualization
            renderNetworkPath(ipAddress, useVPN, finalScore, userAgent);
        }

        const networkTemplate = {
            nodes: [
                { id: 'client', label: 'Client' },
                { id: 'router1', label: 'Router 1' },
                { id: 'router2', label: 'Router 2' },
                { id: 'firewall', label: 'Firewall' },
                { id: 'server', label: 'Server' }
            ],
            connections: [
                { from: 'client', to: 'router1' },
                { from: 'client', to: 'router2' },
                { from: 'router1', to: 'firewall' },
                { from: 'firewall', to: 'server' },
                { from: 'router2', to: 'server' }
            ],
            paths: [
                ['client', 'router1', 'firewall', 'server'],
                ['client', 'router2', 'server']
            ]
        };

        // Generate random positions for nodes
        function generateRandomPositions() {
            const network = JSON.parse(JSON.stringify(networkTemplate));
            const containerWidth = 600;
            const containerHeight = 400;
            const margin = 60;
            
            network.nodes.forEach(node => {
                node.x = margin + Math.random() * (containerWidth - 2 * margin);
                node.y = margin + Math.random() * (containerHeight - 2 * margin);
            });
            
            return network;
        }

        // Current network instance
        let currentNetwork = generateRandomPositions();

        // Draw the network
        function drawNetwork() {
            const container = document.getElementById('network');
            container.innerHTML = ''; // Clear previous network
            
            // Draw connections first
            currentNetwork.connections.forEach(conn => {
                const fromNode = currentNetwork.nodes.find(n => n.id === conn.from);
                const toNode = currentNetwork.nodes.find(n => n.id === conn.to);
                
                const line = document.createElement('div');
                line.className = 'connection';
                
                // Calculate line position and length
                const length = Math.sqrt(
                    Math.pow(toNode.x - fromNode.x, 2) + 
                    Math.pow(toNode.y - fromNode.y, 2)
                );
                const angle = Math.atan2(
                    toNode.y - fromNode.y, 
                    toNode.x - fromNode.x
                ) * 180 / Math.PI;
                
                line.style.width = `${length}px`;
                line.style.left = `${fromNode.x + 20}px`;
                line.style.top = `${fromNode.y + 20}px`;
                line.style.transform = `rotate(${angle}deg)`;
                
                container.appendChild(line);
            });
            
            // Draw nodes
            currentNetwork.nodes.forEach(node => {
                const nodeEl = document.createElement('div');
                nodeEl.className = 'node';
                nodeEl.style.left = `${node.x}px`;
                nodeEl.style.top = `${node.y}px`;
                nodeEl.textContent = node.label;
                container.appendChild(nodeEl);
            });
        }

        // Animate path traversal
        function traversePath(pathIndex) {
            const path = currentNetwork.paths[pathIndex];
            const container = document.getElementById('network');
            
            // Remove any existing packets
            document.querySelectorAll('.packet').forEach(p => p.remove());
            
            // Create a packet element
            const packet = document.createElement('div');
            packet.className = 'packet';
            container.appendChild(packet);
            
            // Start at first node
            const startNode = currentNetwork.nodes.find(n => n.id === path[0]);
            packet.style.left = `${startNode.x + 10}px`;
            packet.style.top = `${startNode.y + 10}px`;
            
            // Move through each node in the path
            let currentIndex = 0;
            const interval = setInterval(() => {
                currentIndex++;
                if (currentIndex >= path.length) {
                    clearInterval(interval);
                    setTimeout(() => {
                        packet.remove();
                    }, 1000);
                    return;
                }
                
                const node = currentNetwork.nodes.find(n => n.id === path[currentIndex]);
                packet.style.left = `${node.x + 10}px`;
                packet.style.top = `${node.y + 10}px`;
            }, 800);
        }

        // Initialize
        // Initialize
        drawNetwork();
        
        // Button click handlers
        document.getElementById('randomizeBtn').addEventListener('click', function() {
            currentNetwork = generateRandomPositions();
            drawNetwork();
        });
        
        document.getElementById('traverseBtn').addEventListener('click', function() {
            // Alternate between the two paths
            const pathIndex = Math.floor(Math.random() * currentNetwork.paths.length);
            traversePath(pathIndex);
        });
        
        function renderNetworkPath(ipAddress, useVPN, score, userAgent) {
            const svg = document.querySelector('#networkDiagram svg');
            // Clear previous diagram except title
            while (svg.childNodes.length > 1) {
                svg.removeChild(svg.lastChild);
            }
            
            // Set diagram title
            document.getElementById('diagramTitle').textContent = `Network Path for ${ipAddress}`;
            
            // Coordinates for nodes
            const nodes = [
                { 
                    id: 'user', 
                    x: 50, 
                    y: 200, 
                    label: 'User Device', 
                    type: useVPN ? 'vpn' : 'user',
                    details: `
                        <strong>${useVPN ? 'VPN User' : 'Direct Connection'}</strong><br>
                        IP: ${ipAddress}<br>
                        Profile: ${userAgent.split(' (')[0]}<br>
                        ${useVPN ? 'VPN increases risk score by 15-25 points' : 'Direct connection has lower base risk'}
                    `
                },
                { 
                    id: 'router1', 
                    x: 150, 
                    y: 150, 
                    label: 'Edge Router', 
                    type: 'router',
                    details: `
                        <strong>Edge Router</strong><br>
                        First network hop<br>
                        Checks basic IP reputation<br>
                        Filters known malicious IPs
                    `
                },
                { 
                    id: 'firewall', 
                    x: 250, 
                    y: 100, 
                    label: 'Firewall', 
                    type: 'firewall',
                    details: `
                        <strong>Network Firewall</strong><br>
                        Deep packet inspection<br>
                        ${score > 50 ? 'Additional scrutiny applied' : 'Standard security checks'}<br>
                        Blocks malicious patterns
                    `
                },
                { 
                    id: 'server', 
                    x: 350, 
                    y: 200, 
                    label: 'Application Server', 
                    type: 'server',
                    details: `
                        <strong>Application Server</strong><br>
                        Final destination<br>
                        ${score > 70 ? 'Request blocked' : 'Request processed'}<br>
                        Logs all activity
                    `
                },
                { 
                    id: 'router2', 
                    x: 250, 
                    y: 250, 
                    label: 'Internal Router', 
                    type: 'router',
                    details: `
                        <strong>Internal Router</strong><br>
                        Secondary network path<br>
                        Used when firewall is bypassed<br>
                        Less secure than firewall path
                    `
                }
            ];
            
            // Draw connections
            const connections = [
                { from: 'user', to: 'router1', details: 'Initial connection from user device to network edge' },
                { from: 'router1', to: 'firewall', details: 'Standard path through security inspection' },
                { from: 'firewall', to: 'server', details: 'Secure path to application server' },
                { from: 'router1', to: 'router2', details: 'Alternative path when firewall blocks traffic' },
                { from: 'router2', to: 'server', details: 'Less secure access to application server' }
            ];
            
            // Draw connections first
            connections.forEach(conn => {
                const fromNode = nodes.find(n => n.id === conn.from);
                const toNode = nodes.find(n => n.id === conn.to);
                
                // Create line
                const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line.setAttribute("x1", fromNode.x);
                line.setAttribute("y1", fromNode.y);
                line.setAttribute("x2", toNode.x);
                line.setAttribute("y2", toNode.y);
                line.setAttribute("class", "network-path");
                line.setAttribute("data-details", conn.details);
                
                // Add hover effects
                line.addEventListener('mouseover', function() {
                    const pathDetails = document.getElementById('pathDetails');
                    pathDetails.innerHTML = `
                        <h5>Connection Details</h5>
                        <p>${conn.details}</p>
                        <p><strong>Security:</strong> ${
                            conn.to === 'firewall' ? 'High (inspected)' : 
                            conn.to === 'router2' ? 'Medium (bypassed firewall)' : 'Standard'
                        }</p>
                    `;
                    line.setAttribute("stroke-width", "4");
                });
                
                line.addEventListener('mouseout', function() {
                    line.setAttribute("stroke-width", "2");
                });
                
                svg.appendChild(line);
                
                // Add arrowhead
                const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
                marker.setAttribute("id", `arrow-${conn.from}-${conn.to}`);
                marker.setAttribute("viewBox", "0 0 10 10");
                marker.setAttribute("refX", "9");
                marker.setAttribute("refY", "5");
                marker.setAttribute("markerWidth", "6");
                marker.setAttribute("markerHeight", "6");
                marker.setAttribute("orient", "auto");
                
                const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                path.setAttribute("d", "M 0 0 L 10 5 L 0 10 z");
                path.setAttribute("fill", "#00b894");
                marker.appendChild(path);
                
                svg.appendChild(marker);
                line.setAttribute("marker-end", `url(#arrow-${conn.from}-${conn.to})`);
            });
            
            // Draw nodes
            nodes.forEach(node => {
                const group = document.createElementNS("http://www.w3.org/2000/svg", "g");
                
                // Draw circle
                const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                circle.setAttribute("cx", node.x);
                circle.setAttribute("cy", node.y);
                circle.setAttribute("r", "20");
                circle.setAttribute("class", `${node.type}-node node`);
                circle.setAttribute("data-details", node.details);
                group.appendChild(circle);
                
                // Add hover effects
                circle.addEventListener('mouseover', function(e) {
                    const nodeInfo = document.getElementById('nodeInfo');
                    nodeInfo.innerHTML = node.details;
                    nodeInfo.style.display = 'block';
                    nodeInfo.style.left = `${e.pageX - 240}px`;
                    nodeInfo.style.top = `${e.pageY - 120}px`;
                });
                
                circle.addEventListener('mouseout', function() {
                    document.getElementById('nodeInfo').style.display = 'none';
                });
                
                // Add click effect
                circle.addEventListener('click', function() {
                    const pathDetails = document.getElementById('pathDetails');
                    pathDetails.innerHTML = `
                        <h5>Node Details: ${node.label}</h5>
                        ${node.details.replace(/<br>/g, '</p><p>')}
                        <p><strong>Current Status:</strong> ${
                            node.type === 'firewall' ? (score > 50 ? 'High inspection mode' : 'Normal operation') :
                            node.type === 'server' ? (score > 70 ? 'Blocking requests' : 'Accepting requests') : 'Operational'
                        }</p>
                    `;
                });
                
                // Add icon
                const icon = document.createElementNS("http://www.w3.org/2000/svg", "text");
                icon.setAttribute("x", node.x);
                icon.setAttribute("y", node.y + 5);
                icon.setAttribute("text-anchor", "middle");
                icon.setAttribute("fill", "white");
                icon.setAttribute("font-size", "12");
                
                if (node.type === 'user') {
                    icon.textContent = "";
                } else if (node.type === 'vpn') {
                    icon.textContent = "";
                } else if (node.type === 'router') {
                    icon.textContent = "";
                } else if (node.type === 'firewall') {
                    icon.textContent = "";
                } else {
                    icon.textContent = "";
                }
                
                group.appendChild(icon);
                
                // Add label
                const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
                label.setAttribute("x", node.x);
                label.setAttribute("y", node.y + 40);
                label.setAttribute("text-anchor", "middle");
                label.setAttribute("font-size", "10");
                label.textContent = node.label;
                group.appendChild(label);
                
                svg.appendChild(group);
            });
            
            // Update path details
            const pathDetails = document.getElementById('pathDetails');
            pathDetails.innerHTML = `
                <h5>Path Analysis</h5>
                <p>The request from ${ipAddress} traveled through ${useVPN ? 'a VPN and ' : ''}multiple network components:</p>
                <ol>
                    <li>User device ${useVPN ? '(via VPN)' : ''}</li>
                    <li>Edge router (first hop)</li>
                    ${score > 50 ? '<li>Firewall (additional inspection)</li>' : ''}
                    <li>Application server</li>
                </ol>
                <div class="alert ${score <= 30 ? 'alert-success' : score <= 70 ? 'alert-warning' : 'alert-danger'} small">
                    <i class="fas fa-${
                        score <= 30 ? 'check-circle' : score <= 70 ? 'exclamation-triangle' : 'times-circle'
                    } me-2"></i>
                    ${score <= 30 ? 'Normal traffic pattern detected' : 
                      score <= 70 ? 'Suspicious activity detected - recommend monitoring' : 
                      'Malicious behavior detected - immediate blocking recommended'}
                </div>
                <p class="small text-muted">Click on any node or connection for detailed information.</p>
            `;
        }
        
        function downloadReport() {
            const ipAddress = document.getElementById('ipAddress').value;
            const score = document.getElementById('scoreResults').textContent.match(/\d+/)[0];
            
            // Create report content
            const reportContent = `
                Sage Network Security Report
                ===========================
                
                IP Address: ${ipAddress}
                Analysis Date: ${new Date().toLocaleString()}
                
                Security Assessment:
                -------------------
                ${document.getElementById('scoreResults').textContent.trim()}
                
                Detailed Findings:
                -----------------
                ${document.getElementById('scoreDetails').textContent.trim()}
                
                Network Path Analysis:
                --------------------
                ${document.getElementById('pathDetails').textContent.trim()}
                
                Recommendations:
                ---------------
                ${score <= 30 ? 'No action required - normal traffic patterns' : 
                 score <= 70 ? 'Monitor activity and consider additional verification' : 
                 'Immediate blocking recommended - malicious behavior detected'}
                
                Generated by Sage Network Security Tracking System
            `;
            
            // Create download link
            const blob = new Blob([reportContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `sage-network-report-${ipAddress}-${new Date().toISOString().slice(0,10)}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            // Show confirmation
            alert(`Report for ${ipAddress} downloaded successfully.`);
        }
        
        function runSpeedTest() {
            const speedTestBtn = document.getElementById('runSpeedTest');
            const speedResult = document.getElementById('speedResult');
            
            speedTestBtn.disabled = true;
            speedTestBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Testing...';
            
            // Simulate speed test with random result
            setTimeout(() => {
                const speed = Math.floor(Math.random() * 100) + 10; // 10-110 Mbps
                const speedMeter = document.querySelector('.speed-meter');
                speedMeter.style.width = `${Math.min(speed, 100)}%`;
                
                speedResult.innerHTML = `
                    <p class="mb-1">Last test: ${speed} Mbps</p>
                    <p class="small ${speed < 30 ? 'text-danger' : speed < 70 ? 'text-warning' : 'text-success'}">
                        ${speed < 30 ? 'Poor connection - may affect security' : 
                         speed < 70 ? 'Average connection' : 'Excellent connection'}
                    </p>
                `;
                
                speedTestBtn.disabled = false;
                speedTestBtn.innerHTML = '<i class="fas fa-play me-1"></i>Run Test';
                
                // Add to Ollama chat
                addOllamaMessage('bot', `Your network speed test completed at ${speed} Mbps. ` +
                    (speed < 30 ? 'This slow connection might affect your security profile.' : 
                     'Your connection speed looks good.'));
            }, 2000);
        }
        
        function sendOllamaMessage() {
            const input = document.getElementById('ollamaInput');
            const message = input.value.trim();
            
            if (message) {
                addOllamaMessage('user', message);
                input.value = '';
                
                // Simulate AI response
                setTimeout(() => {
                    let response;
                    if (message.toLowerCase().includes('risk score')) {
                        const score = document.getElementById('scoreResults').textContent.match(/\d+/);
                        response = score ? 
                            `Your current risk score is ${score[0]}/100. ` +
                            (score[0] <= 30 ? 'This is excellent - no security concerns detected.' :
                             score[0] <= 70 ? 'Moderate risk - we recommend monitoring this activity.' :
                             'High risk - immediate action should be taken.') :
                            'Please run an analysis first to get your risk score.';
                    } 
                    else if (message.toLowerCase().includes('improve')) {
                        response = 'To improve your security score:\n' +
                            '1. Use reputable VPN providers\n' +
                            '2. Maintain consistent access patterns\n' +
                            '3. Keep your devices updated\n' +
                            '4. Avoid suspicious websites';
                    }
                    else if (message.toLowerCase().includes('vpn')) {
                        response = 'VPNs increase your risk score because:\n' +
                            '- VPN IPs are often shared with others\n' +
                            '- Some VPNs are used by malicious actors\n' +
                            '- They obscure your true location\n\n' +
                            'However, reputable VPNs still provide privacy benefits.';
                    }
                    else if (message.toLowerCase().includes('path')) {
                        response = 'The network path shows how your request travels:\n' +
                            '1. From your device through network components\n'
                            '2. Through security checks like firewalls\n' +
                            '3. To the destination server\n\n' +
                            'Red paths indicate higher security scrutiny.';
                    }
                    else {
                        response = 'I can help you understand:\n' +
                            '- Your current risk score\n' +
                            '- How to improve your security\n' +
                            '- Why VPNs affect your score\n' +
                            '- What your network path means\n\n' +
                            'Try asking about one of these topics.';
                    }
                    
                    addOllamaMessage('bot', response);
                }, 1000);
            }
        }
        
        function addOllamaMessage(sender, message) {
            const ollamaChat = document.getElementById('ollamaChat');
            const div = document.createElement('div');
            div.className = `ollama-message ${sender} small p-2 ${sender === 'user' ? 'bg-primary text-white' : 'bg-white'} rounded mb-2`;
            div.innerHTML = `<strong>${sender === 'user' ? 'You:' : 'Sage AI:'}</strong> ${message.replace(/\n/g, '<br>')}`;
            ollamaChat.appendChild(div);
            
            // Auto-scroll to bottom
            ollamaChat.scrollTop = ollamaChat.scrollHeight;
        }

                // ======================== BEHAVIOR TRACKER =======================
// Behavior Tracker with Auto-Download to "JSON folder"
const BehaviorTracker = {
  metrics: {
    sessionStart: null,
    clicks: 0,
    keystrokes: 0,
    mouseDistance: 0,
    lastMousePosition: null,
    lastMouseTime: null
  },

  // Track if button was already clicked
  saveCompleted: false,

  init() {
    this.resetMetrics();
    this.setupEventListeners();
    this.addCaptureButton();
  },

  resetMetrics() {
    this.metrics = {
      sessionStart: new Date().toISOString(),
      clicks: 0,
      keystrokes: 0,
      mouseDistance: 0,
      lastMousePosition: null,
      lastMouseTime: null
    };
  },

  setupEventListeners() {
    document.addEventListener('click', () => this.metrics.clicks++);
    document.addEventListener('keydown', () => this.metrics.keystrokes++);
    document.addEventListener('mousemove', (e) => {
      const now = Date.now();
      if (this.metrics.lastMousePosition && this.metrics.lastMouseTime) {
        const xDiff = e.clientX - this.metrics.lastMousePosition.x;
        const yDiff = e.clientY - this.metrics.lastMousePosition.y;
        this.metrics.mouseDistance += Math.sqrt(xDiff*xDiff + yDiff*yDiff);
      }
      this.metrics.lastMousePosition = { x: e.clientX, y: e.clientY };
      this.metrics.lastMouseTime = now;
    });
  },

  generateReport() {
    const currentTime = new Date();
    const sessionMinutes = (currentTime - new Date(this.metrics.sessionStart)) / 60000;
    
    return {
      timestamp: currentTime.toISOString(),
      sessionDuration: sessionMinutes.toFixed(2) + " minutes",
      clicksPerMin: (this.metrics.clicks / sessionMinutes).toFixed(2),
      keystrokesPerMin: (this.metrics.keystrokes / sessionMinutes).toFixed(2),
      mouseSpeedPxPerSec: (this.metrics.mouseDistance / (sessionMinutes * 60)).toFixed(2),
      totalClicks: this.metrics.clicks,
      totalKeystrokes: this.metrics.keystrokes,
      totalMouseDistance: Math.round(this.metrics.mouseDistance) + "px"
    };
  },

  async saveToJSON() {
    const report = this.generateReport();
    const datePrefix = new Date().toISOString().slice(0, 10);
    const timeSuffix = new Date().toISOString().slice(11, 19).replace(/:/g, '-');
   const fileName = `JSON_behavior_${datePrefix}_${timeSuffix}.json`;
    
    try {
      // Try backend save first
      const response = await fetch('/save-json', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          filename: fileName,
          content: JSON.stringify(report, null, 2)
        })
      });
      
      if (!response.ok) throw new Error('Server error');
      return true;
    } catch (error) {
      console.error("Backend save failed, using download fallback", error);
      // Fallback to client download
      const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = fileName;
      a.click();
      setTimeout(() => URL.revokeObjectURL(url), 100);
      return true;
    }
  },

  addCaptureButton() {
    const existingBtn = document.getElementById('captureMetricsBtn');
    if (existingBtn) return;

    const btn = document.createElement('button');
    btn.id = 'captureMetricsBtn';
    btn.innerHTML = ' Save to JSON Folder';
    Object.assign(btn.style, {
      position: 'fixed',
      bottom: '20px',
      right: '20px',
      zIndex: '9999',
      padding: '10px 15px',
      background: '#4CAF50',
      color: 'white',
      border: 'none',
      borderRadius: '5px',
      cursor: 'pointer',
      boxShadow: '0 2px 5px rgba(0,0,0,0.2)'
    });

    btn.addEventListener('click', async () => {
      if (this.saveCompleted) return;
      
      btn.disabled = true;
      btn.innerHTML = ' Saving...';
      
      try {
        const success = await this.saveToJSON();
        if (success) {
          btn.innerHTML = ' Saved!';
          btn.style.background = '#9E9E9E'; // Gray out
          this.saveCompleted = true;
        }
      } catch (error) {
        console.error("Save failed:", error);
        btn.innerHTML = ' Retry';
        btn.disabled = false;
      }
    });

    document.body.appendChild(btn);
  }
};

// Initialize when page loads
window.addEventListener('DOMContentLoaded', () => BehaviorTracker.init());
    </script>
</body>
</html>